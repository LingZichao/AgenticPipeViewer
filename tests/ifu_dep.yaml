# FSDB Analyzer - Event Dependency Example

fsdbFile: tests/novas.fsdb
clockSignal: tb.clk
# 全局scope（可选）- 简化信号路径书写 // TODO
scope: tb.x_soc.x_cpu_sub_system_axi.x_rv_integration_platform.x_cpu_top.x_ct_top_0.x_ct_core.x_ct_ifu_top

output:
  directory: ifu_reports
  verbose: true
  timeout: 10000000  # 1000ns time window (10000000 * 100fs = 1000ns)

tasks:
  # ============================================
  # TASK 1： 总线读取事件 （icache miss）
  # ============================================
  - id: biu_read
    name: "BIU Read Data Valid Cycles"
    condition:
        - "biu_ifu_rd_data_vld == 1'b1"

    capture:
      - biu_ifu_rd_data

    logging:
      - "Captured a biu read data {biu_ifu_rd_data}"

  # ============================================
  # 下游任务1：使用$dep引用
  # ============================================
  - id: ifu2idu
    name: "Capture IFU to IDU Queue"
    dependsOn: biu_read    # 声明依赖

    # matchMode
    maxMatch: 4
    condition:
    # success:
      - "ifu_idu_ib_inst{idx}_vld == 1'b1"
      - "&& ifu_idu_ib_inst{idx}_data[31: 0] <@ $dep.biu_read.biu_ifu_rd_data.$split(4)"
    # failure:
    capture:
      - ifu_idu_ib_inst{idx}_data
